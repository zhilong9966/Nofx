# NOFX è¾©è®ºç«æŠ€åœºæ¨¡å— - æŠ€æœ¯æ–‡æ¡£

**è¯­è¨€:** [English](DEBATE_MODULE.md) | [ä¸­æ–‡](DEBATE_MODULE.zh-CN.md)

## æ¦‚è¿°

è¾©è®ºç«æŠ€åœºæ˜¯ä¸€ä¸ªå¤š AI åä½œå†³ç­–ç³»ç»Ÿï¼Œå¤šä¸ªå…·æœ‰ä¸åŒæ€§æ ¼çš„ AI æ¨¡å‹å¯¹å¸‚åœºçŠ¶å†µè¿›è¡Œè¾©è®ºå¹¶è¾¾æˆäº¤æ˜“å†³ç­–å…±è¯†ã€‚ç³»ç»Ÿæ”¯æŒå¤šè½®è¾©è®ºã€å®æ—¶æµæ¨é€ã€æŠ•ç¥¨æœºåˆ¶å’Œè‡ªåŠ¨äº¤æ˜“æ‰§è¡Œã€‚

---

## 1. æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            è¾©è®ºç«æŠ€åœºç³»ç»Ÿ                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  å¤šå¤´ AI    â”‚    â”‚  ç©ºå¤´ AI    â”‚    â”‚  åˆ†æ AI   â”‚    â”‚  é£æ§ AI    â”‚  â”‚
â”‚  â”‚     ğŸ‚      â”‚    â”‚     ğŸ»      â”‚    â”‚     ğŸ“Š      â”‚    â”‚     ğŸ›¡ï¸      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                  â”‚                  â”‚                  â”‚          â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                    â”‚                                        â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                          â”‚    è¾©è®ºå¼•æ“       â”‚                              â”‚
â”‚                          â”‚  (debate/engine)  â”‚                              â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                    â”‚                                        â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚         â”‚                          â”‚                          â”‚            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  å¸‚åœºæ•°æ®   â”‚         â”‚   æŠ•ç¥¨ç³»ç»Ÿ        â”‚      â”‚   è‡ªåŠ¨æ‰§è¡Œå™¨    â”‚   â”‚
â”‚  â”‚    ç»„è£…     â”‚         â”‚   ä¸å…±è¯†æœºåˆ¶      â”‚      â”‚   (å¯é€‰)        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ–‡ä»¶ç»“æ„

```
â”œâ”€â”€ debate/
â”‚   â””â”€â”€ engine.go          # æ ¸å¿ƒè¾©è®ºå¼•æ“é€»è¾‘
â”œâ”€â”€ api/
â”‚   â””â”€â”€ debate.go          # HTTP å¤„ç†å™¨å’Œ SSE æµ
â”œâ”€â”€ store/
â”‚   â””â”€â”€ debate.go          # æ•°æ®åº“æ“ä½œå’Œæ¨¡å¼
â””â”€â”€ web/src/pages/
    â””â”€â”€ DebateArenaPage.tsx # å‰ç«¯ UI
```

---

## 2. æ€§æ ¼ç³»ç»Ÿ

### 2.1 å¯ç”¨æ€§æ ¼

| æ€§æ ¼ | å›¾æ ‡ | åç§° | æè¿° | äº¤æ˜“åå‘ |
|------|------|------|------|----------|
| Bull | ğŸ‚ | æ¿€è¿›å¤šå¤´ | å¯»æ‰¾åšå¤šæœºä¼š | ä¹è§‚ï¼Œè¶‹åŠ¿è·Ÿéš |
| Bear | ğŸ» | è°¨æ…ç©ºå¤´ | å…³æ³¨é£é™© | æ‚²è§‚ï¼Œåšç©ºåå‘ |
| Analyst | ğŸ“Š | æ•°æ®åˆ†æå¸ˆ | çº¯æ•°æ®é©±åŠ¨ | æ— åè§ï¼Œå®¢è§‚åˆ†æ |
| Contrarian | ğŸ”„ | é€†åŠ¿è€… | æŒ‘æˆ˜å¤šæ•°è§‚ç‚¹ | å¦ç±»è§†è§’ |
| Risk Manager | ğŸ›¡ï¸ | é£æ§ç»ç† | å…³æ³¨é£é™©æ§åˆ¶ | ä»“ä½ç®¡ç†ï¼Œæ­¢æŸ |

### 2.2 æ€§æ ¼æç¤ºè¯å¢å¼º

**æ–‡ä»¶ä½ç½®:** `debate/engine.go:buildDebateSystemPrompt()` (365-426è¡Œ)

```
## è¾©è®ºæ¨¡å¼ - ç¬¬ {round}/{max_rounds} è½®

ä½ ä½œä¸º {emoji} {personality} å‚ä¸è¾©è®ºã€‚

### ä½ çš„è¾©è®ºè§’è‰²:
{personality_description}

### è¾©è®ºè§„åˆ™:
1. åˆ†ææ‰€æœ‰å€™é€‰å¸ç§
2. ç”¨å…·ä½“æ•°æ®æ”¯æŒè®ºç‚¹
3. å›åº”å…¶ä»–å‚ä¸è€… (ç¬¬2è½®èµ·)
4. æœ‰è¯´æœåŠ›ä½†åŸºäºæ•°æ®
5. å¯ä»¥æ¨èå¤šä¸ªä¸åŒæ“ä½œçš„å¸ç§

### è¾“å‡ºæ ¼å¼ (ä¸¥æ ¼ JSON):
<reasoning>
  - å¸¦æ•°æ®å¼•ç”¨çš„å¸‚åœºåˆ†æ
  - ä¸»è¦äº¤æ˜“è®ºç‚¹
  - å¯¹ä»–äººçš„å›åº” (ç¬¬2è½®èµ·)
</reasoning>

<decision>
[
  {"symbol": "BTCUSDT", "action": "open_long", "confidence": 75, ...},
  {"symbol": "ETHUSDT", "action": "open_short", "confidence": 80, ...}
]
</decision>
```

---

## 3. è¾©è®ºæ‰§è¡Œæµç¨‹

### 3.1 ä¼šè¯åˆ›å»º

```
POST /api/debates
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. éªŒè¯ç”¨æˆ·è®¤è¯                                              â”‚
â”‚ 2. è§£æ CreateDebateRequest:                                â”‚
â”‚    - name, strategy_id, symbol, max_rounds, participants    â”‚
â”‚    - interval_minutes, prompt_variant, auto_execute         â”‚
â”‚ 3. éªŒè¯ç­–ç•¥æ‰€æœ‰æƒ                                            â”‚
â”‚ 4. è‡ªåŠ¨é€‰æ‹©å¸ç§ (å¦‚æœªæä¾›):                                  â”‚
â”‚    - é™æ€å¸ç§ â†’ ä½¿ç”¨ç­–ç•¥ç¬¬ä¸€ä¸ªå¸ç§                           â”‚
â”‚    - CoinPool â†’ ä» AI500 API è·å–                           â”‚
â”‚    - OI Top â†’ ä» OI æ’è¡Œ API è·å–                           â”‚
â”‚    - Mixed â†’ å…ˆå°è¯•æ± ï¼Œå›é€€åˆ° OI                            â”‚
â”‚ 5. è®¾ç½®é»˜è®¤å€¼:                                               â”‚
â”‚    - max_rounds: 3 (èŒƒå›´ 2-5)                               â”‚
â”‚    - interval_minutes: 5                                    â”‚
â”‚    - prompt_variant: "balanced"                             â”‚
â”‚ 6. åœ¨æ•°æ®åº“åˆ›å»º DebateSession                               â”‚
â”‚ 7. æ·»åŠ å¸¦ AI æ¨¡å‹å’Œæ€§æ ¼çš„å‚ä¸è€…                              â”‚
â”‚ 8. è¿”å›å®Œæ•´ä¼šè¯åŠå‚ä¸è€…                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 è¾©è®ºè½®æ¬¡æ‰§è¡Œ

**æ–‡ä»¶ä½ç½®:** `debate/engine.go:runDebate()` (157-289è¡Œ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¯è½® (1 åˆ° max_rounds):                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ 1. å¹¿æ’­ "round_start" äº‹ä»¶                              â”‚ â”‚
â”‚ â”‚ 2. æ¯ä¸ªå‚ä¸è€… (æŒ‰ speak_order):                         â”‚ â”‚
â”‚ â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚ â”‚    â”‚ a. æ„å»ºæ€§æ ¼å¢å¼ºçš„ç³»ç»Ÿæç¤ºè¯                      â”‚  â”‚ â”‚
â”‚ â”‚    â”‚ b. æ„å»ºç”¨æˆ·æç¤ºè¯:                               â”‚  â”‚ â”‚
â”‚ â”‚    â”‚    - å¸‚åœºæ•°æ® (æ¥è‡ªç­–ç•¥å¼•æ“)                     â”‚  â”‚ â”‚
â”‚ â”‚    â”‚    - ä¹‹å‰çš„è¾©è®ºæ¶ˆæ¯ (ç¬¬2è½®èµ·)                    â”‚  â”‚ â”‚
â”‚ â”‚    â”‚ c. è°ƒç”¨ AI æ¨¡å‹ï¼Œ60ç§’è¶…æ—¶                        â”‚  â”‚ â”‚
â”‚ â”‚    â”‚ d. ä»å“åº”è§£æå¤šå¸ç§å†³ç­–                          â”‚  â”‚ â”‚
â”‚ â”‚    â”‚ e. ä¿å­˜æ¶ˆæ¯åˆ°æ•°æ®åº“                              â”‚  â”‚ â”‚
â”‚ â”‚    â”‚ f. å¹¿æ’­ "message" äº‹ä»¶                           â”‚  â”‚ â”‚
â”‚ â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚ â”‚ 3. å¹¿æ’­ "round_end" äº‹ä»¶                                â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚ æ‰€æœ‰è½®æ¬¡å:                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ 1. è¿›å…¥æŠ•ç¥¨é˜¶æ®µ (status = "voting")                     â”‚ â”‚
â”‚ â”‚ 2. æ”¶é›†æ‰€æœ‰å‚ä¸è€…çš„æœ€ç»ˆæŠ•ç¥¨                             â”‚ â”‚
â”‚ â”‚ 3. ç¡®å®šå¤šå¸ç§å…±è¯†                                       â”‚ â”‚
â”‚ â”‚ 4. å­˜å‚¨æœ€ç»ˆå†³ç­–                                         â”‚ â”‚
â”‚ â”‚ 5. æ›´æ–°çŠ¶æ€ä¸º "completed"                               â”‚ â”‚
â”‚ â”‚ 6. å¹¿æ’­ "consensus" äº‹ä»¶                                â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. å…±è¯†ç®—æ³•

### 4.1 æŠ•ç¥¨æ”¶é›†

**æ–‡ä»¶ä½ç½®:** `debate/engine.go:collectVotes()` (542-567è¡Œ)

```
æ¯ä¸ªå‚ä¸è€…:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æ„å»ºæŠ•ç¥¨ç³»ç»Ÿæç¤ºè¯                                        â”‚
â”‚ 2. æ„å»ºå¸¦è¾©è®ºæ‘˜è¦çš„æŠ•ç¥¨ç”¨æˆ·æç¤ºè¯                            â”‚
â”‚ 3. è°ƒç”¨ AI æ¨¡å‹è·å–æœ€ç»ˆæŠ•ç¥¨                                  â”‚
â”‚ 4. è§£æå¤šå¸ç§å†³ç­–                                            â”‚
â”‚ 5. éªŒè¯/ä¿®å¤å¸ç§ä¸ session.Symbol ä¸€è‡´                       â”‚
â”‚ 6. ä¿å­˜æŠ•ç¥¨åˆ°æ•°æ®åº“                                          â”‚
â”‚ 7. å¹¿æ’­ "vote" äº‹ä»¶                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 å¤šå¸ç§å…±è¯†ç¡®å®š

**æ–‡ä»¶ä½ç½®:** `debate/engine.go:determineMultiCoinConsensus()` (752-924è¡Œ)

**ç®—æ³•:**

```
1. æ”¶é›†æ‰€æœ‰æŠ•ç¥¨ä¸­çš„æ‰€æœ‰å¸ç§å†³ç­–
2. æŒ‰ symbol â†’ action â†’ èšåˆæ•°æ® åˆ†ç»„

3. å¯¹æ¯ä¸ªæŠ•ç¥¨å†³ç­–:
   weight = confidence / 100.0
   ç´¯åŠ :
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ score += weight                                         â”‚
   â”‚ total_confidence += confidence                          â”‚
   â”‚ total_leverage += leverage                              â”‚
   â”‚ total_position_pct += position_pct                      â”‚
   â”‚ total_stop_loss += stop_loss                            â”‚
   â”‚ total_take_profit += take_profit                        â”‚
   â”‚ count++                                                 â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4. å¯¹æ¯ä¸ªå¸ç§:
   æ‰¾åˆ°èƒœå‡ºæ“ä½œ (æœ€é«˜ score)
   è®¡ç®—å¹³å‡å€¼:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ avg_confidence = total_confidence / count               â”‚
   â”‚ avg_leverage = clamp(total_leverage / count, 1, 20)     â”‚
   â”‚ avg_position_pct = clamp(total_pct / count, 0.1, 1.0)   â”‚
   â”‚ avg_stop_loss = é»˜è®¤ 3% (å¦‚æœªè®¾ç½®)                       â”‚
   â”‚ avg_take_profit = é»˜è®¤ 6% (å¦‚æœªè®¾ç½®)                     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

5. è¿”å›å…±è¯†å†³ç­–æ•°ç»„
```

### 4.3 å…±è¯†ç¤ºä¾‹

**è¾“å…¥æŠ•ç¥¨:**
```
AI1 (å¤šå¤´):   BTC open_long  (conf=80, lev=10, pos=0.3)
AI2 (ç©ºå¤´):   BTC open_short (conf=60, lev=5, pos=0.2)
AI3 (åˆ†æ):   BTC open_long  (conf=70, lev=8, pos=0.25)
```

**è®¡ç®—:**
```
open_long:
  score = 0.80 + 0.70 = 1.50
  avg_conf = (80 + 70) / 2 = 75
  avg_lev = (10 + 8) / 2 = 9
  avg_pos = (0.3 + 0.25) / 2 = 0.275

open_short:
  score = 0.60
  avg_conf = 60
  avg_lev = 5
  avg_pos = 0.2

èƒœå‡º: open_long (score 1.50 > 0.60)
```

**è¾“å‡º:**
```json
{
  "symbol": "BTCUSDT",
  "action": "open_long",
  "confidence": 75,
  "leverage": 9,
  "position_pct": 0.275,
  "stop_loss": 0.03,
  "take_profit": 0.06
}
```

---

## 5. è‡ªåŠ¨æ‰§è¡Œ

### 5.1 æ‰§è¡Œæµç¨‹

**æ–‡ä»¶ä½ç½®:** `debate/engine.go:ExecuteConsensus()` (932-1052è¡Œ)

```
POST /api/debates/:id/execute
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. éªŒè¯ä¼šè¯çŠ¶æ€ = completed                                  â”‚
â”‚ 2. éªŒè¯ final_decision å­˜åœ¨ä¸”æœªæ‰§è¡Œ                         â”‚
â”‚ 3. éªŒè¯æ“ä½œæ˜¯ open_long æˆ– open_short                       â”‚
â”‚ 4. è·å–å½“å‰å¸‚åœºä»·æ ¼                                          â”‚
â”‚ 5. è·å–è´¦æˆ·ä½™é¢:                                             â”‚
â”‚    - å°è¯• available_balance                                  â”‚
â”‚    - å›é€€åˆ° total_equity æˆ– wallet_balance                  â”‚
â”‚ 6. è®¡ç®—ä»“ä½å¤§å°:                                             â”‚
â”‚    position_size_usd = available_balance Ã— position_pct     â”‚
â”‚    (æœ€å° $12 ä»¥æ»¡è¶³äº¤æ˜“æ‰€è¦æ±‚)                               â”‚
â”‚ 7. è®¡ç®—æ­¢æŸå’Œæ­¢ç›ˆä»·æ ¼:                                       â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚    â”‚ open_long:                                        â”‚    â”‚
â”‚    â”‚   SL = price Ã— (1 - stop_loss_pct)               â”‚    â”‚
â”‚    â”‚   TP = price Ã— (1 + take_profit_pct)             â”‚    â”‚
â”‚    â”‚ open_short:                                       â”‚    â”‚
â”‚    â”‚   SL = price Ã— (1 + stop_loss_pct)               â”‚    â”‚
â”‚    â”‚   TP = price Ã— (1 - take_profit_pct)             â”‚    â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚ 8. åˆ›å»º Decision å¯¹è±¡                                        â”‚
â”‚ 9. è°ƒç”¨ executor.ExecuteDecision()                          â”‚
â”‚ 10. æ›´æ–° final_decision:                                    â”‚
â”‚     - executed = true/false                                 â”‚
â”‚     - executed_at = æ—¶é—´æˆ³                                   â”‚
â”‚     - error æ¶ˆæ¯ (å¦‚å¤±è´¥)                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. API æ¥å£

### 6.1 æ¥å£åˆ—è¡¨

| æ¥å£ | æ–¹æ³• | æè¿° |
|------|------|------|
| `/api/debates` | GET | åˆ—å‡ºç”¨æˆ·æ‰€æœ‰è¾©è®º |
| `/api/debates/personalities` | GET | è·å– AI æ€§æ ¼é…ç½® |
| `/api/debates/:id` | GET | è·å–è¾©è®ºè¯¦æƒ… |
| `/api/debates` | POST | åˆ›å»ºæ–°è¾©è®º |
| `/api/debates/:id/start` | POST | å¼€å§‹è¾©è®ºæ‰§è¡Œ |
| `/api/debates/:id/cancel` | POST | å–æ¶ˆè¿è¡Œä¸­çš„è¾©è®º |
| `/api/debates/:id/execute` | POST | æ‰§è¡Œå…±è¯†äº¤æ˜“ |
| `/api/debates/:id` | DELETE | åˆ é™¤è¾©è®º |
| `/api/debates/:id/messages` | GET | è·å–æ‰€æœ‰æ¶ˆæ¯ |
| `/api/debates/:id/votes` | GET | è·å–æ‰€æœ‰æŠ•ç¥¨ |
| `/api/debates/:id/stream` | GET | SSE å®æ—¶æµ |

### 6.2 åˆ›å»ºè¾©è®ºè¯·æ±‚

```json
POST /api/debates
{
  "name": "BTC å¸‚åœºè¾©è®º",
  "strategy_id": "strategy-uuid",
  "symbol": "BTCUSDT",
  "max_rounds": 3,
  "interval_minutes": 5,
  "prompt_variant": "balanced",
  "auto_execute": false,
  "trader_id": "trader-uuid",
  "enable_oi_ranking": true,
  "oi_ranking_limit": 10,
  "oi_duration": "1h",
  "participants": [
    {"ai_model_id": "deepseek-v3", "personality": "bull"},
    {"ai_model_id": "qwen-max", "personality": "bear"},
    {"ai_model_id": "gpt-5.2", "personality": "analyst"}
  ]
}
```

---

## 7. å®æ—¶æ›´æ–° (SSE)

### 7.1 SSE æ¥å£

**æ–‡ä»¶ä½ç½®:** `api/debate.go:HandleDebateStream()` (407-453è¡Œ)

```
GET /api/debates/:id/stream
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. éªŒè¯ç”¨æˆ·æ‰€æœ‰æƒ                                            â”‚
â”‚ 2. è®¾ç½® SSE å¤´:                                              â”‚
â”‚    Content-Type: text/event-stream                          â”‚
â”‚    Cache-Control: no-cache                                  â”‚
â”‚    Connection: keep-alive                                   â”‚
â”‚ 3. å‘é€åˆå§‹çŠ¶æ€                                              â”‚
â”‚ 4. è®¢é˜…äº‹ä»¶                                                  â”‚
â”‚ 5. æµå¼æ¨é€æ›´æ–°ç›´åˆ°å®¢æˆ·ç«¯æ–­å¼€                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 äº‹ä»¶ç±»å‹

| äº‹ä»¶ | è§¦å‘æ—¶æœº | æ•°æ® |
|------|----------|------|
| `initial` | è¿æ¥å¼€å§‹ | å®Œæ•´ä¼šè¯çŠ¶æ€ |
| `round_start` | è½®æ¬¡å¼€å§‹ | `{round, status}` |
| `message` | AI å‘è¨€ | DebateMessage å¯¹è±¡ |
| `round_end` | è½®æ¬¡ç»“æŸ | `{round, status}` |
| `vote` | AI æŠ•ç¥¨ | DebateVote å¯¹è±¡ |
| `consensus` | è¾©è®ºå®Œæˆ | DebateDecision å¯¹è±¡ |
| `error` | å‘ç”Ÿé”™è¯¯ | `{error: string}` |

---

## 8. æ•°æ®åº“æ¨¡å¼

### 8.1 è¡¨ç»“æ„

**debate_sessions:**
```sql
CREATE TABLE debate_sessions (
  id TEXT PRIMARY KEY,
  user_id TEXT NOT NULL,
  name TEXT NOT NULL,
  strategy_id TEXT NOT NULL,
  status TEXT NOT NULL DEFAULT 'pending',
  symbol TEXT NOT NULL,
  max_rounds INTEGER DEFAULT 3,
  current_round INTEGER DEFAULT 0,
  interval_minutes INTEGER DEFAULT 5,
  prompt_variant TEXT DEFAULT 'balanced',
  final_decision TEXT,
  final_decisions TEXT,
  auto_execute BOOLEAN DEFAULT 0,
  trader_id TEXT,
  enable_oi_ranking BOOLEAN DEFAULT 0,
  oi_ranking_limit INTEGER DEFAULT 10,
  oi_duration TEXT DEFAULT '1h',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

**debate_participants:**
```sql
CREATE TABLE debate_participants (
  id TEXT PRIMARY KEY,
  session_id TEXT NOT NULL,
  ai_model_id TEXT NOT NULL,
  ai_model_name TEXT NOT NULL,
  provider TEXT NOT NULL,
  personality TEXT NOT NULL,
  color TEXT NOT NULL,
  speak_order INTEGER DEFAULT 0,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (session_id) REFERENCES debate_sessions(id) ON DELETE CASCADE
);
```

**debate_messages:**
```sql
CREATE TABLE debate_messages (
  id TEXT PRIMARY KEY,
  session_id TEXT NOT NULL,
  round INTEGER NOT NULL,
  ai_model_id TEXT NOT NULL,
  ai_model_name TEXT NOT NULL,
  provider TEXT NOT NULL,
  personality TEXT NOT NULL,
  message_type TEXT NOT NULL,
  content TEXT NOT NULL,
  decision TEXT,
  decisions TEXT,
  confidence INTEGER DEFAULT 0,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (session_id) REFERENCES debate_sessions(id) ON DELETE CASCADE
);
```

**debate_votes:**
```sql
CREATE TABLE debate_votes (
  id TEXT PRIMARY KEY,
  session_id TEXT NOT NULL,
  ai_model_id TEXT NOT NULL,
  ai_model_name TEXT NOT NULL,
  action TEXT NOT NULL,
  symbol TEXT NOT NULL,
  confidence INTEGER DEFAULT 0,
  leverage INTEGER DEFAULT 5,
  position_pct REAL DEFAULT 0.2,
  stop_loss_pct REAL DEFAULT 0.03,
  take_profit_pct REAL DEFAULT 0.06,
  reasoning TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (session_id) REFERENCES debate_sessions(id) ON DELETE CASCADE
);
```

---

## 9. å‰ç«¯ç»„ä»¶

### 9.1 é¡µé¢ç»“æ„

**æ–‡ä»¶ä½ç½®:** `web/src/pages/DebateArenaPage.tsx`

```
DebateArenaPage
â”œâ”€â”€ å·¦ä¾§è¾¹æ  (w-56)
â”‚   â”œâ”€â”€ æ–°å»ºè¾©è®ºæŒ‰é’®
â”‚   â”œâ”€â”€ è¾©è®ºä¼šè¯åˆ—è¡¨
â”‚   â”‚   â””â”€â”€ SessionItem (çŠ¶æ€, åç§°, æ—¶é—´æˆ³)
â”‚   â””â”€â”€ åœ¨çº¿äº¤æ˜“å‘˜åˆ—è¡¨
â”‚       â””â”€â”€ TraderItem (åç§°, çŠ¶æ€, AI æ¨¡å‹)
â”‚
â”œâ”€â”€ ä¸»å†…å®¹åŒº
â”‚   â”œâ”€â”€ å¤´éƒ¨æ 
â”‚   â”‚   â”œâ”€â”€ ä¼šè¯ä¿¡æ¯ (åç§°, çŠ¶æ€, å¸ç§)
â”‚   â”‚   â”œâ”€â”€ å‚ä¸è€…å¤´åƒ
â”‚   â”‚   â””â”€â”€ æŠ•ç¥¨æ‘˜è¦
â”‚   â”‚
â”‚   â”œâ”€â”€ å†…å®¹åŒº (åŒæ )
â”‚   â”‚   â”œâ”€â”€ å·¦: è®¨è®ºè®°å½•
â”‚   â”‚   â”‚   â”œâ”€â”€ è½®æ¬¡æ ‡é¢˜
â”‚   â”‚   â”‚   â””â”€â”€ MessageCards (å¯å±•å¼€)
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ å³: æœ€ç»ˆæŠ•ç¥¨
â”‚   â”‚       â””â”€â”€ VoteCards (æ“ä½œ, ç½®ä¿¡åº¦, ç†ç”±)
â”‚   â”‚
â”‚   â””â”€â”€ å…±è¯†æ 
â”‚       â”œâ”€â”€ æœ€ç»ˆå†³ç­–æ˜¾ç¤º
â”‚       â””â”€â”€ æ‰§è¡ŒæŒ‰é’® (å¦‚æœ auto_execute ç¦ç”¨)
â”‚
â””â”€â”€ å¼¹çª—
    â”œâ”€â”€ CreateModal
    â”‚   â”œâ”€â”€ åç§°è¾“å…¥
    â”‚   â”œâ”€â”€ ç­–ç•¥é€‰æ‹©å™¨
    â”‚   â”œâ”€â”€ å¸ç§è¾“å…¥ (è‡ªåŠ¨å¡«å……)
    â”‚   â”œâ”€â”€ æœ€å¤§è½®æ•°é€‰æ‹©å™¨
    â”‚   â””â”€â”€ å‚ä¸è€…é€‰æ‹©å™¨ (AI æ¨¡å‹ + æ€§æ ¼)
    â”‚
    â””â”€â”€ ExecuteModal
        â””â”€â”€ äº¤æ˜“å‘˜é€‰æ‹©å™¨
```

### 9.2 çŠ¶æ€é¢œè‰²

```typescript
const STATUS_COLOR = {
  pending: 'bg-gray-500',
  running: 'bg-blue-500 animate-pulse',
  voting: 'bg-yellow-500 animate-pulse',
  completed: 'bg-green-500',
  cancelled: 'bg-red-500',
}
```

### 9.3 æ“ä½œæ ·å¼

```typescript
const ACT = {
  open_long: {
    color: 'text-green-400',
    bg: 'bg-green-500/20',
    icon: <TrendingUp />,
    label: 'LONG'
  },
  open_short: {
    color: 'text-red-400',
    bg: 'bg-red-500/20',
    icon: <TrendingDown />,
    label: 'SHORT'
  },
  hold: {
    color: 'text-blue-400',
    bg: 'bg-blue-500/20',
    icon: <Minus />,
    label: 'HOLD'
  },
  wait: {
    color: 'text-gray-400',
    bg: 'bg-gray-500/20',
    icon: <Clock />,
    label: 'WAIT'
  },
}
```

---

## 10. é›†æˆç‚¹

### 10.1 ç­–ç•¥ç³»ç»Ÿ

è¾©è®ºä¼šè¯ä¾èµ–ä¿å­˜çš„ç­–ç•¥:
- **å¸ç§æ¥æºé…ç½®:** static/pool/OI top
- **å¸‚åœºæ•°æ®æŒ‡æ ‡:** Kçº¿ã€æ—¶é—´å‘¨æœŸã€æŠ€æœ¯æŒ‡æ ‡
- **é£æ§å‚æ•°:** æ æ†é™åˆ¶ã€ä»“ä½å¤§å°
- **è‡ªå®šä¹‰æç¤ºè¯:** è§’è‰²å®šä¹‰ã€äº¤æ˜“è§„åˆ™

### 10.2 AI æ¨¡å‹ç³»ç»Ÿ

æ¯ä¸ªå‚ä¸è€…éœ€è¦:
- AI æ¨¡å‹é…ç½® (provider, API key, è‡ªå®šä¹‰ URL)
- æ”¯æŒçš„ providers: deepseek, qwen, openai, claude, gemini, grok, kimi
- å®¢æˆ·ç«¯åˆå§‹åŒ–å¸¦è¶…æ—¶å¤„ç† (æ¯æ¬¡è°ƒç”¨ 60s)

### 10.3 äº¤æ˜“å‘˜ç³»ç»Ÿ

è‡ªåŠ¨æ‰§è¡Œéœ€è¦:
- è¿è¡Œä¸­çŠ¶æ€çš„æ´»è·ƒäº¤æ˜“å‘˜
- äº¤æ˜“å‘˜å¿…é¡»æœ‰æœ‰æ•ˆçš„äº¤æ˜“æ‰€è¿æ¥
- æ‰§è¡Œå™¨æ¥å£: `ExecuteDecision()`, `GetBalance()`

---

## æ€»ç»“

è¾©è®ºç«æŠ€åœºæ¨¡å—æä¾›äº†ä¸€ä¸ªå¤æ‚çš„å¤š AI åä½œå†³ç­–ç³»ç»Ÿ:

- **å¤šæ€§æ ¼è¾©è®º:** 5 ç§ç‹¬ç‰¹çš„ AI æ€§æ ¼ (å¤šå¤´ã€ç©ºå¤´ã€åˆ†æå¸ˆã€é€†åŠ¿è€…ã€é£æ§ç»ç†)ï¼Œå…·æœ‰ç‹¬ç‰¹çš„äº¤æ˜“åå‘
- **å…±è¯†æœºåˆ¶:** åŸºäºç½®ä¿¡åº¦çš„åŠ æƒæŠ•ç¥¨æ¥ç¡®å®šæœ€ç»ˆå†³ç­–
- **å®æ—¶æ›´æ–°:** SSE æµæ¨é€å®æ—¶è¾©è®ºè¿›åº¦
- **è‡ªåŠ¨æ‰§è¡Œ:** å¯é€‰çš„åŸºäºå…±è¯†çš„è‡ªåŠ¨äº¤æ˜“æ‰§è¡Œ
- **ç­–ç•¥é›†æˆ:** ä¸ç­–ç•¥é…ç½®æ·±åº¦é›†æˆï¼Œç”¨äºå¸‚åœºæ•°æ®å’Œé£æ§å‚æ•°
- **å¤šå¸ç§æ”¯æŒ:** èƒ½å¤ŸåŒæ—¶åˆ†æå’Œå†³ç­–å¤šä¸ªå¸ç§

è¯¥ç³»ç»Ÿä½¿ç”¨æˆ·èƒ½å¤Ÿåˆ©ç”¨å¤šä¸ª AI è§†è§’åšå‡ºæ›´ç¨³å¥çš„äº¤æ˜“å†³ç­–ï¼ŒåŒæ—¶ä¿æŒå¯¹æ‰§è¡Œçš„å®Œå…¨æ§åˆ¶ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬:** 1.0.0
**æœ€åæ›´æ–°:** 2025-01-15
